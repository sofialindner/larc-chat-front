<main class="main-container">
  <aside class="chat-history glass-card">
    <span class="chat-history__label">Usuários online</span>
    <ul>
      @for (user of users(); track user.id) {
        @let offline = isOffline(user);
        <li>
          <a class="chat-item" [class.active]="isActiveUser(user.id)" [routerLink]="[user.id]">
            @if (isBroadcast(user)) {
              <div class="broadcast-icon">
                <mat-icon>campaign</mat-icon>
              </div>

              <div class="user-info">
                <span class="username">Todos</span>
                <span class="last-message">Chat</span>
              </div>
            } @else {
              <ng-container
                [ngTemplateOutlet]="userTmpl"
                [ngTemplateOutletContext]="{ user, offline }"
              ></ng-container>
            }
          </a>
        </li>
      }
    </ul>

    <div class="account">
      <ng-container
        [ngTemplateOutlet]="userTmpl"
        [ngTemplateOutletContext]="{ user: currentUser(), offline: false }"
      ></ng-container>
    </div>
  </aside>

  <div class="chat-wrapper">
    <router-outlet></router-outlet>
  </div>
</main>

<ng-template #userTmpl let-user="user" let-offline="offline">
  <app-user-media [offline]="offline"></app-user-media>

  <div class="user-info">
    <span class="username">{{ user.username }}</span>
    <span class="last-message">{{
      offline ? `Última vez online às ${(user.lastTimeOnline | date: 'shortTime')}` : 'Online'
    }}</span>
  </div>
</ng-template>
